from kivy.app import App
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.button import Button
from kivy.uix.scrollview import ScrollView
from kivy.uix.label import Label
from kivy.uix.popup import Popup
from kivy.utils import get_color_from_hex
from kivy.core.window import Window
from plyer import notification
import webbrowser

class AnimeApp(App):
    def build(self):
        # Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯ Ø§Ù„ÙØ®Ù…
        Window.clearcolor = get_color_from_hex('#000000') 
        self.root_layout = BoxLayout(orientation='vertical', padding=10, spacing=10)
        
        # 1. Ø§Ù„Ø±Ø£Ø³ (Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¨Ø­Ø«)
        header = BoxLayout(size_hint_y=0.1)
        header.add_widget(Label(
            text='EMPEROR ANIME', 
            font_size='26sp', 
            bold=True, 
            color=get_color_from_hex('#8A2BE2') # Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¨Ø±Ù‚ÙŠ
        ))
        btn_search = Button(
            text='ğŸ”', 
            size_hint_x=0.2, 
            background_color=(0,0,0,0), 
            color=get_color_from_hex('#8A2BE2')
        )
        header.add_widget(btn_search)
        self.root_layout.add_widget(header)

        # 2. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± (Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ù…ÙŠ)
        scroll = ScrollView(size_hint_y=0.8)
        self.list_layout = BoxLayout(orientation='vertical', size_hint_y=None, spacing=20)
        self.list_layout.bind(minimum_height=self.list_layout.setter('height'))

        # Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ (Ø§Ù„Ø§Ø³Ù…ØŒ Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚ØªØŒ Ø§Ù„Ø±Ø§Ø¨Ø·)
        anime_list = [
            ("One Piece", "Next Ep in: 1D 4H", "https://link1.com"),
            ("Solo Leveling", "Next Ep in: 3D 10H", "https://link2.com"),
            ("Naruto Shuppuden", "Full Episodes", "https://link3.com")
        ]

        for name, time_left, link in anime_list:
            # Ø­Ø§ÙˆÙŠØ© Ù„ÙƒÙ„ Ø£Ù†Ù…ÙŠ
            anime_box = BoxLayout(orientation='vertical', size_hint_y=None, height=140)
            
            # Ø²Ø± Ø§Ù„Ø£Ù†Ù…ÙŠ Ø¨ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†ÙŠÙˆÙ†
            btn = Button(
                text=f"{name}\n[size=14][color=8A2BE2]{time_left}[/color][/size]", 
                markup=True,
                background_normal='',
                background_color=get_color_from_hex('#1A1A1A'), # Ø£Ø³ÙˆØ¯ Ø®ÙÙŠÙ
                color=(1, 1, 1, 1),
                font_size='20sp'
            )
            # Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· ØªØ¸Ù‡Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬ÙˆØ¯Ø§Øª
            btn.bind(on_release=lambda x, n=name: self.show_quality_popup(n))
            
            anime_box.add_widget(btn)
            self.list_layout.add_widget(anime_box)

        scroll.add_widget(self.list_layout)
        self.root_layout.add_widget(scroll)

        # 3. Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ (Ø¹Ù„Ø§Ù…Ø© Ø¨ÙŠØª ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)
        footer = BoxLayout(size_hint_y=0.1, padding=5)
        home_btn = Button(
            text='ğŸ ', 
            size_hint_x=0.2, 
            background_normal='',
            background_color=get_color_from_hex('#4B0082') # Ø¨Ù†ÙØ³Ø¬ÙŠ ØºØ§Ù…Ù‚
        )
        footer.add_widget(home_btn)
        footer.add_widget(Label(text='')) # ÙØ±Ø§Øº Ù„Ù…ÙˆØ§Ø²Ù†Ø© Ø§Ù„Ø´ÙƒÙ„
        self.root_layout.add_widget(footer)

        return self.root_layout

    def show_quality_popup(self, anime_name):
        # Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª
        content = BoxLayout(orientation='vertical', spacing=10, padding=15)
        content.add_widget(Label(text=f"Choose Quality for {anime_name}", color=get_color_from_hex('#8A2BE2'), bold=True))
        
        qualities = ['1080p (Ultra HD) âš¡', '720p (High) âš¡', '480p (SD) âš¡', 'Server 2']
        for q in qualities:
            q_btn = Button(text=q, background_color=get_color_from_hex('#4B0082'), color=(1,1,1,1))
            # Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙŠÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­ (ÙƒÙ…Ø«Ø§Ù„)
            q_btn.bind(on_release=lambda x: webbrowser.open("https://www.google.com"))
            content.add_widget(q_btn)

        popup = Popup(
            title='Emperor Selection', 
            content=content, 
            size_hint=(0.85, 0.7),
            background_color=get_color_from_hex('#000000')
        )
        popup.open()
        
        # ØªØ¬Ø±Ø¨Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        self.send_notification(anime_name)

    def send_notification(self, anime_name):
        try:
            notification.notify(
                title='Emperor Anime',
                message=f'You are watching {anime_name}! Enjoy âš¡',
                app_icon=None, 
                timeout=10
            )
        except:
            pass

if __name__ == '__main__':
    AnimeApp().run()
