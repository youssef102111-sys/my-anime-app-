from kivy.app import App
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.button import Button
from kivy.uix.scrollview import ScrollView
from kivy.uix.label import Label
from kivy.uix.image import AsyncImage
from kivy.uix.popup import Popup
from kivy.utils import get_color_from_hex
from kivy.core.window import Window
from plyer import notification
import webbrowser

class AnimeApp(App):
    def build(self):
        Window.clearcolor = get_color_from_hex('#000000') # Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ ÙØ®Ù…Ø©
        self.root_layout = BoxLayout(orientation='vertical', padding=10, spacing=10)
        
        # Ø§Ù„Ø±Ø£Ø³ (Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¨Ø­Ø«)
        header = BoxLayout(size_hint_y=0.1)
        header.add_widget(Label(text='EMPEROR ANIME', font_size='24sp', bold=True, color=get_color_from_hex('#8A2BE2')))
        btn_search = Button(text='ğŸ”', size_hint_x=0.2, background_color=(0,0,0,0), color=get_color_from_hex('#8A2BE2'))
        header.add_widget(btn_search)
        self.root_layout.add_widget(header)

        # Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ±
        scroll = ScrollView(size_hint_y=0.8)
        self.list_layout = BoxLayout(orientation='vertical', size_hint_y=None, spacing=15)
        self.list_layout.bind(minimum_height=self.list_layout.setter('height'))

        # Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ù…ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø­Ù„Ù‚Ø©ØŒ Ø§Ù„Ø±Ø§Ø¨Ø·)
        anime_data = [
            ("One Piece", "Next: Tomorrow 8PM", "https://link-to-video.com"),
            ("Solo Leveling", "Next: Sat 10PM", "https://link-to-video.com"),
        ]

        for name, timer, link in anime_data:
            item = BoxLayout(orientation='vertical', size_hint_y=None, height=150, padding=5)
            
            # Ø²Ø± Ø§Ù„Ø£Ù†Ù…ÙŠ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø§Ø³Ù…)
            btn = Button(text=f"{name}\n[color=8A2BE2]{timer}[/color]", markup=True, 
                         background_color=get_color_from_hex('#1A1A1A'), color=(1,1,1,1))
            btn.bind(on_release=lambda x, n=name: self.show_quality_popup(n))
            
            item.add_widget(btn)
            self.list_layout.add_widget(item)

        scroll.add_widget(self.list_layout)
        self.root_layout.add_widget(scroll)

        # Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ (Ø¹Ù„Ø§Ù…Ø© Ø¨ÙŠØª ÙˆØ§Ø­Ø¯Ø©)
        footer = BoxLayout(size_hint_y=0.1, padding=5)
        home_btn = Button(text='ğŸ ', size_hint_x=0.2, background_color=get_color_from_hex('#4B0082'))
        footer.add_widget(home_btn)
        footer.add_widget(Label(text='')) # ÙØ±Ø§Øº Ù„Ù„ØªÙ†Ø³ÙŠÙ‚
        self.root_layout.add_widget(footer)

        return self.root_layout

    def show_quality_popup(self, anime_name):
        # Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬ÙˆØ¯Ø§Øª ÙˆØ§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠØ©
        content = BoxLayout(orientation='vertical', spacing=10, padding=10)
        content.add_widget(Label(text=f"Select Quality for {anime_name}", color=get_color_from_hex('#8A2BE2')))
        
        for q in ['1080p âš¡', '720p âš¡', '480p âš¡', 'Server 2']:
            btn = Button(text=q, background_color=get_color_from_hex('#4B0082'))
            btn.bind(on_release=lambda x: webbrowser.open("https://youtube.com"))
            content.add_widget(btn)

        popup = Popup(title='Quality Selection', content=content, size_hint=(0.8, 0.6),
                      background_color=get_color_from_hex('#000000'))
        popup.open()

    def send_anime_notify(self, anime_name):
        # ÙˆØ¸ÙŠÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        notification.notify(title='Emperor Anime', message=f'New Episode of {anime_name} is OUT! âš¡')

if __name__ == '__main__':
    AnimeApp().run()
